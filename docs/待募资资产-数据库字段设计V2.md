# 待募资资产录入 - 数据库字段设计文档（V2.0）

## 1. 主表：t_direct_recommendation（定向推荐项目表）

### 1.1 基础信息字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_no | VARCHAR | 32 | 是 | - | 项目编号（唯一，如DR202502040001）|
| project_name | VARCHAR | 200 | 是 | - | **资产名称**（如：广州白云核心区住宅项目）|
| project_brief | TEXT | - | 是 | - | **资产简介**（核心卖点概述）|
| project_type | TINYINT | 1 | 是 | 1 | 项目类型：1-资产推介 2-定向推荐 3-专项招募 |
| category_id | INT | 10 | 否 | NULL | 资产分类ID（关联字典表：住宅/商业/工业等）|
| category_name | VARCHAR | 50 | 否 | NULL | 资产分类名称（冗余存储）|

### 1.2 位置信息字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| province_code | VARCHAR | 20 | 否 | NULL | 省份编码（国标）|
| province_name | VARCHAR | 50 | 否 | NULL | 省份名称（如：广东省）|
| city_code | VARCHAR | 20 | 否 | NULL | 城市编码（国标）|
| city_name | VARCHAR | 50 | 否 | NULL | 城市名称（如：广州市）|
| district_code | VARCHAR | 20 | 否 | NULL | 区县编码 |
| district_name | VARCHAR | 50 | 否 | NULL | 区县名称（如：白云区）|
| location_detail | VARCHAR | 500 | 否 | NULL | **详细位置**（如：白云新城核心区，近地铁2号线）|
| location_lng | DECIMAL | 10,7 | 否 | NULL | 经度（地图定位用）|
| location_lat | DECIMAL | 10,7 | 否 | NULL | 纬度（地图定位用）|

### 1.3 项目亮点/配套字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| supporting_facilities | TEXT | - | 否 | NULL | **项目配套**（如：凯悦酒店、龙湖代建、山湖景观）|
| market_analysis | TEXT | - | 否 | NULL | **市场分析**（如：区域高端产品供给紧缺）|
| project_highlights | TEXT | - | 否 | NULL | **核心亮点**（如：劣后投资人储备充足、回款预期好）|
| risk_control | TEXT | - | 否 | NULL | **风控措施**（如：抵质押等完善风控）|

### 1.4 资金需求字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| fund_type | VARCHAR | 50 | 是 | - | **资金类型**（如：夹层/劣后/优先/平层）|
| fund_scale_min | DECIMAL | 18,2 | 否 | NULL | 资金规模下限（万元）|
| fund_scale_max | DECIMAL | 18,2 | 否 | NULL | **资金规模上限**（万元）|
| fund_scale_unit | TINYINT | 1 | 是 | 2 | 金额单位：1-万元 2-亿元 |
| fund_duration | INT | 3 | 否 | NULL | **合作期限**（年/月，单位见duration_unit）|
| duration_unit | TINYINT | 1 | 是 | 1 | 期限单位：1-年 2-月 3-季度 |
| fund_usage | VARCHAR | 200 | 否 | NULL | 资金用途说明 |
| expected_return | VARCHAR | 100 | 否 | NULL | 预期收益描述 |

### 1.5 发布方信息字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| publisher_org_id | VARCHAR | 50 | 否 | NULL | **发布机构ID**（关联组织架构）|
| publisher_org_name | VARCHAR | 200 | 是 | - | **发布机构名称**（如：XX资产运营中心）|
| publisher_id | VARCHAR | 50 | 是 | - | 发布人员ID（飞书用户ID）|
| publisher_name | VARCHAR | 50 | 是 | - | **发布人员姓名** |
| publisher_mobile | VARCHAR | 20 | 是 | - | **发布人员手机号** |
| publisher_dept | VARCHAR | 100 | 否 | NULL | 发布人所属部门 |

### 1.6 时间/状态字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| display_start_date | DATE | - | 是 | - | **展示开始日期** |
| display_end_date | DATE | 是 | - | **展示截止日期** |
| display_days | INT | 5 | 否 | NULL | 展示期限（天，自动计算）|
| submit_time | DATETIME | - | 否 | NULL | 提交审核时间 |
| approve_time | DATETIME | - | 否 | NULL | 审批通过时间 |
| approver_id | VARCHAR | 50 | 否 | NULL | 审批人ID |
| approver_name | VARCHAR | 50 | 否 | NULL | 审批人姓名 |
| approve_remark | VARCHAR | 500 | 否 | NULL | 审批备注/驳回原因 |
| status | TINYINT | 1 | 是 | 0 | 状态：0-草稿 1-待审批 2-已发布 3-已驳回 4-已撤回 5-已过期 6-已下架 |
| is_top | TINYINT | 1 | 是 | 0 | 是否置顶：0-否 1-是 |
| sort_order | INT | 5 | 是 | 0 | 排序权重（数值越大越靠前）|

### 1.7 附件/统计字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| attachment_id | BIGINT | 20 | 否 | NULL | 主附件ID（PDF）|
| attachment_url | VARCHAR | 500 | 否 | NULL | PDF附件URL（加水印后）|
| attachment_original_name | VARCHAR | 200 | 否 | NULL | 原始文件名 |
| attachment_size | BIGINT | 15 | 否 | NULL | 文件大小（字节）|
| view_count | INT | 10 | 是 | 0 | 浏览次数 |
| push_count | INT | 10 | 是 | 0 | 推送次数 |
| interest_count | INT | 10 | 是 | 0 | 感兴趣人数 |

### 1.8 系统字段

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| is_deleted | TINYINT | 1 | 是 | 0 | 是否删除：0-否 1-是 |
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 更新时间 |
| create_by | VARCHAR | 50 | 是 | - | 创建人ID |
| update_by | VARCHAR | 50 | 是 | - | 最后更新人ID |
| version | INT | 10 | 是 | 1 | 版本号（乐观锁）|

---

## 2. 项目联系人表：t_dr_contact（一对多）

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| contact_name | VARCHAR | 50 | 是 | - | **联系人姓名**（如：叶女士、何先生）|
| contact_title | VARCHAR | 50 | 否 | NULL | **联系人称谓**（如：项目经理、业务总监）|
| contact_mobile | VARCHAR | 20 | 是 | - | **联系人手机号**（如：13857969724）|
| contact_wechat | VARCHAR | 50 | 否 | NULL | 微信号 |
| contact_email | VARCHAR | 100 | 否 | NULL | 邮箱 |
| is_primary | TINYINT | 1 | 是 | 0 | 是否主要联系人：0-否 1-是 |
| sort_order | INT | 3 | 是 | 0 | 排序 |
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 创建时间 |
| is_deleted | TINYINT | 1 | 是 | 0 | 是否删除 |

---

## 3. 白名单表：t_dr_whitelist（目标服务商）

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| org_id | VARCHAR | 50 | 否 | NULL | 机构ID（系统内）|
| org_name | VARCHAR | 200 | 是 | - | **机构名称**（如：浙江特资矿业有限公司）|
| org_short_name | VARCHAR | 50 | 否 | NULL | 机构简称 |
| contact_name | VARCHAR | 50 | 是 | - | **联系人姓名** |
| contact_mobile | VARCHAR | 20 | 是 | - | **联系人手机号**（AES加密）|
| mobile_hash | VARCHAR | 64 | 是 | - | 手机号MD5哈希 |
| user_id | VARCHAR | 50 | 否 | NULL | 系统用户ID |
| is_registered | TINYINT | 1 | 是 | 0 | 是否已注册 |
| view_count | INT | 5 | 是 | 0 | 浏览次数 |
| first_view_time | DATETIME | - | 否 | NULL | 首次查看时间 |
| last_view_time | DATETIME | - | 否 | NULL | 最后查看时间 |
| is_interested | TINYINT | 1 | 是 | 0 | 是否感兴趣 |
| interest_time | DATETIME | - | 否 | NULL | 点击感兴趣时间 |
| sort_order | INT | 5 | 是 | 0 | 排序（导入顺序）|
| is_deleted | TINYINT | 1 | 是 | 0 | 是否删除 |
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

---

## 4. 附件表：t_dr_attachment（支持多附件）

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| file_name | VARCHAR | 200 | 是 | - | 原始文件名 |
| file_url | VARCHAR | 500 | 是 | - | 文件URL |
| file_type | TINYINT | 1 | 是 | 1 | 文件类型：1-PDF 2-图片 3-其他 |
| file_size | BIGINT | 15 | 是 | - | 文件大小（字节）|
| is_watermarked | TINYINT | 1 | 是 | 0 | 是否已加水印 |
| watermarked_url | VARCHAR | 500 | 否 | NULL | 加水印后的URL |
| is_primary | TINYINT | 1 | 是 | 0 | 是否主附件 |
| sort_order | INT | 3 | 是 | 0 | 排序 |
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 创建时间 |
| is_deleted | TINYINT | 1 | 是 | 0 | 是否删除 |

---

## 5. 审批记录表：t_dr_approval_log

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| operation_type | TINYINT | 1 | 是 | - | 操作类型：1-提交 2-通过 3-驳回 4-撤回 5-编辑 6-下架 |
| operation_remark | VARCHAR | 500 | 否 | NULL | 操作备注 |
| operator_id | VARCHAR | 50 | 是 | - | 操作人ID |
| operator_name | VARCHAR | 50 | 是 | - | 操作人姓名 |
| before_status | TINYINT | 1 | 否 | NULL | 操作前状态 |
| after_status | TINYINT | 1 | 否 | NULL | 操作后状态 |
| operation_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 操作时间 |

---

## 6. 推送记录表：t_dr_push_log

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| whitelist_id | BIGINT | 20 | 否 | NULL | 关联白名单ID |
| push_type | TINYINT | 1 | 是 | - | 推送类型：1-短信 2-APP推送 3-站内信 |
| push_target | VARCHAR | 20 | 是 | - | 推送目标（手机号）|
| push_content | TEXT | - | 是 | - | 推送内容全文 |
| short_link | VARCHAR | 200 | 是 | - | 短链地址 |
| send_status | TINYINT | 1 | 是 | 0 | 0-待发送 1-发送中 2-成功 3-失败 |
| send_time | DATETIME | - | 否 | NULL | 实际发送时间 |
| result_code | VARCHAR | 50 | 否 | NULL | 发送结果码 |
| result_msg | VARCHAR | 200 | 否 | NULL | 发送结果描述 |
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 创建时间 |

---

## 7. 用户查看日志表：t_dr_view_log

| 字段名 | 字段类型 | 长度 | 必填 | 默认值 | 注释说明 |
|--------|---------|------|------|--------|----------|
| id | BIGINT UNSIGNED | 20 | 是 | 自增 | 主键ID |
| project_id | BIGINT | 20 | 是 | - | 关联项目ID |
| user_id | VARCHAR | 50 | 否 | NULL | 查看用户ID |
| mobile | VARCHAR | 20 | 否 | NULL | 用户手机号（加密）|
| view_source | TINYINT | 1 | 是 | - | 1-短信 2-APP推送 3-主动浏览 4-分享 |
| device_type | TINYINT | 1 | 否 | NULL | 1-iOS 2-Android 3-H5 4-PC |
| ip_address | VARCHAR | 50 | 否 | NULL | IP地址 |
| user_agent | VARCHAR | 500 | 否 | NULL | UA信息 |
| view_duration | INT | 6 | 否 | NULL | 停留时长（秒）|
| create_time | DATETIME | - | 是 | CURRENT_TIMESTAMP | 查看时间 |

---

## 8. 字典表（参考）

### 8.1 资产分类（t_dict_asset_category）

| 分类编码 | 分类名称 | 父级ID |
|---------|---------|--------|
| 1 | 住宅地产 | 0 |
| 2 | 商业地产 | 0 |
| 3 | 工业地产 | 0 |
| 4 | 不良资产 | 0 |
| 5 | 股权投资 | 0 |

### 8.2 资金类型（t_dict_fund_type）

| 类型编码 | 类型名称 |
|---------|---------|
| 1 | 夹层 |
| 2 | 劣后 |
| 3 | 优先 |
| 4 | 平层 |
| 5 | 可转债 |
| 6 | 其他 |

---

## 9. 示例数据对照

### 业务场景（demo内容）→ 数据库字段映射：

| Demo内容 | 对应字段 | 示例值 |
|---------|---------|--------|
| 广州白云核心区优质合作机会 | project_name | 广州白云核心区住宅项目 |
| 低密纯改善住宅 | category_name | 住宅地产 |
| 广州白云核心区 | city_name + district_name | 广州市 + 白云区 |
| 凯悦酒店、龙湖代建、山湖景观 | supporting_facilities | 凯悦酒店、龙湖代建、山湖景观 |
| 区域高端产品供给紧缺 | market_analysis | 区域高端产品供给段紧缺 |
| 劣后投资人储备充足、回款预期好 | project_highlights | 劣后投资人客群储备充足、回款预期较好 |
| 抵质押等完善风控 | risk_control | 项目具备抵质押等完善风控 |
| 1亿内夹层合作资金 | fund_scale_max + fund_type | 10000万元 + 夹层 |
| 期限3年 | fund_duration + duration_unit | 3 + 年 |
| 叶女士、何先生 | t_dr_contact.contact_name | 叶女士 / 何先生 |
| 13857969724、15158118599 | t_dr_contact.contact_mobile | 对应手机号 |
| 8家合营服务商 | t_dr_whitelist.org_name | 各机构名称 |

---

## 10. 索引设计

### 10.1 主表索引
```sql
PRIMARY KEY (`id`),
UNIQUE KEY `uk_project_no` (`project_no`),
KEY `idx_status` (`status`),
KEY `idx_project_type` (`project_type`),
KEY `idx_category` (`category_id`),
KEY `idx_publisher` (`publisher_id`),
KEY `idx_city` (`city_code`),
KEY `idx_display_date` (`display_start_date`, `display_end_date`),
KEY `idx_create_time` (`create_time`),
KEY `idx_is_top` (`is_top`, `sort_order`),
KEY `idx_fund_type` (`fund_type`)
```

### 10.2 白名单索引
```sql
PRIMARY KEY (`id`),
KEY `idx_project_id` (`project_id`),
KEY `idx_mobile_hash` (`mobile_hash`),
KEY `idx_user_id` (`user_id`),
UNIQUE KEY `uk_project_mobile` (`project_id`, `mobile_hash`)
```

---

## 11. 核心业务逻辑

### 11.1 项目编号生成
```sql
-- 每日从0001开始自增
CONCAT('DR', DATE_FORMAT(NOW(), '%Y%m%d'), LPAD(seq, 4, '0'))
```

### 11.2 排序规则
```sql
ORDER BY is_top DESC, sort_order DESC, create_time DESC
```

### 11.3 自动过期任务
```sql
UPDATE t_direct_recommendation 
SET status = 5, update_time = NOW()
WHERE display_end_date < CURDATE() 
AND status = 2;
```

### 11.4 白名单权限校验
```sql
SELECT COUNT(1) FROM t_dr_whitelist 
WHERE project_id = ? 
AND mobile_hash = MD5(?) 
AND is_deleted = 0;
```

---

**文档版本**：V2.0  
**创建时间**：2026-02-04  
**适用场景**：定向推荐功能数据开发
